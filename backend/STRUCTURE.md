# Thesis-Check Backend é¡¹ç›®ç»“æ„

## ğŸ“ ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ app/                          # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ api/                      # APIè·¯ç”±å±‚
â”‚   â”‚   â””â”€â”€ v1/                   # API v1ç‰ˆæœ¬ï¼ˆæ‰€æœ‰ç«¯ç‚¹ä»¥/api/v1å¼€å¤´ï¼‰
â”‚   â”‚       â”œâ”€â”€ __init__.py       # è·¯ç”±æ³¨å†Œ
â”‚   â”‚       â”œâ”€â”€ auth.py           # è®¤è¯è·¯ç”±ï¼ˆæ³¨å†Œ/ç™»å½•/ä¸ªäººä¿¡æ¯ï¼‰
â”‚   â”‚       â”œâ”€â”€ users.py          # ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ papers.py         # è®ºæ–‡ç®¡ç†è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ templates.py      # æ¨¡æ¿ç®¡ç†è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ check.py          # è®ºæ–‡æ£€æŸ¥è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ results.py        # æ£€æŸ¥ç»“æœè·¯ç”±
â”‚   â”‚       â”œâ”€â”€ previous_papers.py # å¾€å±Šè®ºæ–‡è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ parameters.py     # å‚æ•°è®¾ç½®è·¯ç”±
â”‚   â”‚       â””â”€â”€ statistics.py     # ç»Ÿè®¡åˆ†æè·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ security.py           # JWTä»¤ç‰Œã€å¯†ç åŠ å¯†
â”‚   â”‚   â”œâ”€â”€ permissions.py        # RBACæƒé™æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ exceptions.py         # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®åº“æ¨¡å‹ï¼ˆSQLAlchemyï¼‰
â”‚   â”‚   â”œâ”€â”€ user.py               # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ paper.py              # è®ºæ–‡æ¨¡å‹ï¼ˆæ¯•ä¸š/è¯¾è®¾/å¾€å±Šï¼‰
â”‚   â”‚   â”œâ”€â”€ template.py           # æ¨¡æ¿æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ check.py              # æ£€æŸ¥ç»“æœå’Œé—®é¢˜æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ parameter.py          # å‚æ•°è®¾ç½®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.py               # ç”¨æˆ·ç›¸å…³Schema
â”‚   â”‚   â”œâ”€â”€ paper.py              # è®ºæ–‡ç›¸å…³Schema
â”‚   â”‚   â”œâ”€â”€ template.py           # æ¨¡æ¿ç›¸å…³Schema
â”‚   â”‚   â”œâ”€â”€ check.py              # æ£€æŸ¥ç›¸å…³Schema
â”‚   â”‚   â”œâ”€â”€ parameter.py          # å‚æ•°ç›¸å…³Schema
â”‚   â”‚   â”œâ”€â”€ common.py             # é€šç”¨Schemaï¼ˆåˆ†é¡µã€æ¶ˆæ¯ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ auth_service.py       # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ check_service.py      # æ£€æŸ¥æœåŠ¡ï¼ˆé¢˜ç›®/æ ¼å¼/å†…å®¹ï¼‰
â”‚   â”‚   â”œâ”€â”€ ai_service.py         # é˜¿é‡Œäº‘AIæœåŠ¡å°è£…
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ file_handler.py       # æ–‡ä»¶å¤„ç†ï¼ˆä¸Šä¼ /ä¿å­˜/åˆ é™¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ docx_parser.py        # Wordæ–‡æ¡£è§£æ
â”‚   â”‚   â”œâ”€â”€ similarity.py         # ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆTF-IDF/ä½™å¼¦ï¼‰
â”‚   â”‚   â”œâ”€â”€ search_engine.py      # Whooshå…¨æ–‡æœç´¢
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ config.py                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.py               # æ•°æ®åº“è¿æ¥å’Œä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ dependencies.py           # ä¾èµ–æ³¨å…¥ï¼ˆè®¤è¯ä¸­é—´ä»¶ï¼‰
â”‚   â”œâ”€â”€ main.py                   # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½•ï¼ˆè¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ database/                 # SQLiteæ•°æ®åº“æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ paper_checking.db
â”‚   â”œâ”€â”€ storage/                  # æ–‡ä»¶å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ graduation/           # æ¯•ä¸šè®ºæ–‡
â”‚   â”‚   â”œâ”€â”€ course/               # è¯¾è®¾è®ºæ–‡
â”‚   â”‚   â”œâ”€â”€ templates/            # æ¨¡æ¿æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ reports/              # æ£€æŸ¥æŠ¥å‘Š
â”‚   â””â”€â”€ whoosh_index/             # æœç´¢ç´¢å¼•æ–‡ä»¶
â”‚
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                    # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–
â”œâ”€â”€ start.ps1                     # å¯åŠ¨è„šæœ¬ï¼ˆPowerShellï¼‰
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â””â”€â”€ STRUCTURE.md                  # æœ¬æ–‡ä»¶
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: FastAPI 0.110+
- **æ•°æ®åº“**: SQLite + SQLAlchemy 2.x (å¼‚æ­¥)
- **è®¤è¯**: JWT + Bcrypt
- **æ–‡ä»¶å¤„ç†**: python-docx
- **æœç´¢å¼•æ“**: Whoosh + jieba
- **ç›¸ä¼¼åº¦è®¡ç®—**: scikit-learn (TF-IDF, ä½™å¼¦ç›¸ä¼¼åº¦)
- **AIæœåŠ¡**: é˜¿é‡Œäº‘å¤§æ¨¡å‹API
- **å¼‚æ­¥**: asyncio (æ— éœ€Redis/Celery)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ã€‚

### 3. å¯åŠ¨æœåŠ¡

```bash
# Windows PowerShell
.\start.ps1

# æˆ–ç›´æ¥ä½¿ç”¨uvicorn
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 4. è®¿é—®APIæ–‡æ¡£

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## ğŸ“¡ APIç«¯ç‚¹åˆ—è¡¨

æ‰€æœ‰APIç«¯ç‚¹éƒ½ä»¥ `/api/v1` ä¸ºå‰ç¼€ã€‚

### è®¤è¯ (`/api/v1/auth`)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/v1/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/v1/auth/login` | ç”¨æˆ·ç™»å½• |
| GET | `/api/v1/auth/me` | è·å–å½“å‰ç”¨æˆ· |
| PUT | `/api/v1/auth/profile` | æ›´æ–°ä¸ªäººèµ„æ–™ |
| PUT | `/api/v1/auth/password` | ä¿®æ”¹å¯†ç  |
| POST | `/api/v1/auth/logout` | ç™»å‡º |

### ç”¨æˆ·ç®¡ç† (`/api/v1/users`)

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v1/users` | è·å–ç”¨æˆ·åˆ—è¡¨ | æ•™å¸ˆ+ |
| GET | `/api/v1/users/{id}` | è·å–ç”¨æˆ·è¯¦æƒ… | - |
| PUT | `/api/v1/users/{id}/role` | ä¿®æ”¹ç”¨æˆ·è§’è‰² | ç®¡ç†å‘˜ |
| DELETE | `/api/v1/users/{id}` | åˆ é™¤ç”¨æˆ· | ç®¡ç†å‘˜ |

### è®ºæ–‡ç®¡ç† (`/api/v1/papers`)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/v1/papers/graduation` | ä¸Šä¼ æ¯•ä¸šè®ºæ–‡ |
| POST | `/api/v1/papers/course` | ä¸Šä¼ è¯¾è®¾è®ºæ–‡ |
| GET | `/api/v1/papers` | è·å–è®ºæ–‡åˆ—è¡¨ |
| GET | `/api/v1/papers/{id}` | è·å–è®ºæ–‡è¯¦æƒ… |
| DELETE | `/api/v1/papers/{id}` | åˆ é™¤è®ºæ–‡ |

### æ¨¡æ¿ç®¡ç† (`/api/v1/templates`)

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| POST | `/api/v1/templates` | ä¸Šä¼ æ¨¡æ¿ | æ•™å¸ˆ+ |
| GET | `/api/v1/templates` | è·å–æ¨¡æ¿åˆ—è¡¨ | - |
| DELETE | `/api/v1/templates/{id}` | åˆ é™¤æ¨¡æ¿ | æ•™å¸ˆ+ |

### è®ºæ–‡æ£€æŸ¥ (`/api/v1/check`)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/v1/check/submit` | æäº¤æ£€æŸ¥ä»»åŠ¡ |
| GET | `/api/v1/check/status/{task_id}` | è·å–æ£€æŸ¥çŠ¶æ€ |

### æ£€æŸ¥ç»“æœ (`/api/v1/results`)

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/v1/results` | è·å–ç»“æœåˆ—è¡¨ |
| GET | `/api/v1/results/{id}` | è·å–ç»“æœè¯¦æƒ… |

### å¾€å±Šè®ºæ–‡ (`/api/v1/previous-papers`)

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| POST | `/api/v1/previous-papers` | æ·»åŠ å¾€å±Šè®ºæ–‡ | æ•™å¸ˆ+ |
| GET | `/api/v1/previous-papers` | è·å–å¾€å±Šè®ºæ–‡ | - |
| DELETE | `/api/v1/previous-papers/{id}` | åˆ é™¤å¾€å±Šè®ºæ–‡ | æ•™å¸ˆ+ |

### å‚æ•°è®¾ç½® (`/api/v1/parameters`)

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| POST | `/api/v1/parameters` | åˆ›å»ºå‚æ•° | ä¸»ä»»+ |
| GET | `/api/v1/parameters` | è·å–å‚æ•°åˆ—è¡¨ | - |
| PUT | `/api/v1/parameters/{id}` | æ›´æ–°å‚æ•° | ä¸»ä»»+ |
| POST | `/api/v1/parameters/{id}/lock` | é”å®šå‚æ•° | é™¢é•¿ |
| POST | `/api/v1/parameters/{id}/unlock` | è§£é”å‚æ•° | é™¢é•¿ |

### ç»Ÿè®¡åˆ†æ (`/api/v1/statistics`)

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v1/statistics/overview` | æ¦‚è§ˆç»Ÿè®¡ | æ•™å¸ˆ+ |
| GET | `/api/v1/statistics/department` | é™¢ç³»ç»Ÿè®¡ | ä¸»ä»»+ |
| GET | `/api/v1/statistics/teacher` | æ•™å¸ˆç»Ÿè®¡ | ä¸»ä»»+ |

## ğŸ” æƒé™ä½“ç³»

ç³»ç»Ÿå®ç°äº†5çº§RBACæƒé™æ§åˆ¶ï¼š

1. **å­¦ç”Ÿ (student)**: åŸºç¡€æƒé™ï¼Œå¯ç®¡ç†è‡ªå·±çš„è®ºæ–‡
2. **æ•™å¸ˆ (teacher)**: å¯æŸ¥çœ‹æ‰€æœ‰è®ºæ–‡ã€ç®¡ç†æ¨¡æ¿
3. **ä¸»ä»» (director)**: æ•™å¸ˆæƒé™ + å‚æ•°è®¾ç½®ã€ç»Ÿè®¡åˆ†æ
4. **é™¢é•¿ (dean)**: ä¸»ä»»æƒé™ + é”å®š/è§£é”å‚æ•°
5. **ç®¡ç†å‘˜ (admin)**: æœ€é«˜æƒé™ï¼Œå¯ç®¡ç†æ‰€æœ‰èµ„æº

## ğŸ”„ å¼‚æ­¥ä»»åŠ¡å¤„ç†

è®ºæ–‡æ£€æŸ¥ç­‰è€—æ—¶æ“ä½œä½¿ç”¨ Python `asyncio.create_task()` å®ç°å¼‚æ­¥å¤„ç†ï¼š

1. ç”¨æˆ·æäº¤æ£€æŸ¥ä»»åŠ¡
2. ç³»ç»Ÿç«‹å³è¿”å›ä»»åŠ¡ID
3. åå°å¼‚æ­¥æ‰§è¡Œæ£€æŸ¥
4. ç”¨æˆ·é€šè¿‡ä»»åŠ¡IDè½®è¯¢æŸ¥è¯¢è¿›åº¦
5. æ£€æŸ¥å®ŒæˆåæŸ¥çœ‹ç»“æœ

## ğŸ“‚ æ•°æ®å­˜å‚¨

### æ•°æ®åº“
- SQLiteæ•°æ®åº“æ–‡ä»¶: `data/database/paper_checking.db`
- è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„ï¼Œæ— éœ€æ‰‹åŠ¨åˆå§‹åŒ–

### æ–‡ä»¶å­˜å‚¨
æ‰€æœ‰ä¸Šä¼ æ–‡ä»¶å­˜å‚¨åœ¨ `data/storage/` ç›®å½•ï¼š
- `graduation/`: æ¯•ä¸šè®ºæ–‡
- `course/`: è¯¾è®¾è®ºæ–‡
- `templates/`: æ¨¡æ¿æ–‡ä»¶
- `reports/`: æ£€æŸ¥æŠ¥å‘Š

### æœç´¢ç´¢å¼•
Whooshå…¨æ–‡æœç´¢ç´¢å¼•å­˜å‚¨åœ¨ `data/whoosh_index/`

## ğŸ”‘ é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·

é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºï¼š

- **ç”¨æˆ·å**: admin
- **é‚®ç®±**: admin@thesis-check.com
- **å¯†ç **: Admin@123456

**âš ï¸ ç”Ÿäº§ç¯å¢ƒè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼**

## ğŸ§ª å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„APIç«¯ç‚¹

1. åœ¨ `app/api/v1/` åˆ›å»ºæˆ–ç¼–è¾‘è·¯ç”±æ–‡ä»¶
2. åœ¨ `app/api/v1/__init__.py` æ³¨å†Œè·¯ç”±
3. å®ç°å¯¹åº”çš„æœåŠ¡é€»è¾‘ï¼ˆå¦‚éœ€è¦ï¼‰

### æ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹

1. åœ¨ `app/models/` åˆ›å»ºæ¨¡å‹æ–‡ä»¶
2. åœ¨ `app/schemas/` åˆ›å»ºå¯¹åº”çš„Schema
3. é‡å¯åº”ç”¨ï¼Œæ•°æ®åº“è¡¨ä¼šè‡ªåŠ¨åˆ›å»º

### ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| DATABASE_URL | æ•°æ®åº“è¿æ¥ | sqlite+aiosqlite:///./data/database/paper_checking.db |
| SECRET_KEY | JWTå¯†é’¥ | éœ€è¦è®¾ç½® |
| ALIBABA_API_KEY | é˜¿é‡Œäº‘APIå¯†é’¥ | éœ€è¦è®¾ç½® |
| STORAGE_PATH | æ–‡ä»¶å­˜å‚¨è·¯å¾„ | ./data/storage |
| MAX_UPLOAD_SIZE | æœ€å¤§ä¸Šä¼ å¤§å° | 52428800 (50MB) |

## ğŸ“ æ³¨æ„äº‹é¡¹

1. `data/` ç›®å½•å·²æ·»åŠ åˆ° `.gitignore`ï¼Œä¸ä¼šè¢«æäº¤åˆ°Git
2. é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨åˆ›å»ºæ‰€æœ‰å¿…è¦çš„ç›®å½•å’Œæ•°æ®åº“
3. æ‰€æœ‰APIç«¯ç‚¹éƒ½ä»¥ `/api/v1` ä¸ºå‰ç¼€
4. æ”¯æŒè·¨åŸŸè¯·æ±‚ï¼ˆCORSï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒéœ€é…ç½®å…·ä½“åŸŸå
5. è®ºæ–‡æ£€æŸ¥ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹

## ğŸ› æ•…éšœæ’æŸ¥

### å¯¼å…¥é”™è¯¯
ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

### æ•°æ®åº“é”™è¯¯
åˆ é™¤ `data/database/` ç›®å½•ï¼Œé‡å¯åº”ç”¨é‡æ–°åˆ›å»ºã€‚

### ç«¯å£è¢«å ç”¨
ä¿®æ”¹å¯åŠ¨å‘½ä»¤ä¸­çš„ç«¯å£å·ï¼š
```bash
uvicorn app.main:app --reload --port 8001
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- FastAPI: https://fastapi.tiangolo.com/
- SQLAlchemy: https://docs.sqlalchemy.org/
- Pydantic: https://docs.pydantic.dev/
- Whoosh: https://whoosh.readthedocs.io/
